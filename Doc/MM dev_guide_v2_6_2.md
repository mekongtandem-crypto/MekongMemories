# Guide de d√©veloppement - M√©moire du M√©kong v2.6

**Derni√®re mise √† jour : Phase 18 - Navigation & Syst√®me de liens**  
**Date : 20 octobre 2025**

---

## üìã Table des mati√®res

1. [Vue d'ensemble du Projet](#vue-densemble-du-projet)
2. [Architecture g√©n√©rale](#architecture-g√©n√©rale)
3. [Structure des fichiers](#structure-des-fichiers)
4. [Composants principaux](#composants-principaux)
5. [Syst√®me visuel unifi√©](#syst√®me-visuel-unifi√©)
6. [Gestion des photos](#gestion-des-photos)
7. [Messages et sessions](#messages-et-sessions)
8. [Syst√®me de notifications](#syst√®me-de-notifications)
9. [Syst√®me de th√®mes](#syst√®me-de-th√®mes)
10. [**Navigation et liens internes** ‚≠ê](#navigation-et-liens-internes)
11. [Interface utilisateur](#interface-utilisateur)
12. [Bonnes pratiques](#bonnes-pratiques)
13. [M√©thodologie de travail](#m√©thodologie-de-travail)
14. [Phases compl√©t√©es](#phases-compl√©t√©es)
15. [Roadmap : Phase 18](#roadmap-phase-18)

---

## üéØ Vue d'ensemble du Projet

### **Intention**

"M√©moire du M√©kong" est une application web progressive (PWA) con√ßue comme un **carnet d'exp√©riences de voyage interactif**. L'objectif est de transformer une simple chronologie de voyage en une exploration th√©matique et immersive des souvenirs avec un **syst√®me conversationnel** permettant de relier et d'enrichir les contenus.

### **Fonctionnalit√©s Cl√©s**

- **üóÇÔ∏è Donn√©es Centralis√©es :** Stockage sur Google Drive
- **‚ú® Navigation par Moments :** Unit√©s th√©matiques (1+ jours)
- **‚è±Ô∏è Timeline Interactive :** Frise chronologique visuelle
- **üì∞ Contenu Riche :** Articles Mastodon + galeries photos
- **üí¨ Sessions conversationnelles :** Dialogues autour des souvenirs
- **üîó Liens internes :** R√©f√©rences entre chats et souvenirs
- **üîî Notifications push :** Communication asynchrone entre utilisateurs
- **üè∑Ô∏è Th√®mes personnalis√©s :** Organisation th√©matique des contenus
- **‚öôÔ∏è Synchronisation Automatique :** Connexion Drive au d√©marrage

---

## üèó Architecture g√©n√©rale

### Stack technique

- **React 18** (hooks, refs, forwardRef, useMemo)
- **Vite** (build tool)
- **Tailwind CSS** (styling)
- **Lucide React** (ic√¥nes)
- **Google Drive API** (stockage + notifications)

### Pattern architectural

- **MVVM-like** : DataManager ‚Üî useAppState ‚Üî Components
- **Pub/Sub** : Listeners pour synchronisation
- **Repository** : DriveSync pour abstraction stockage
- **Window Callbacks** : Communication TopBar ‚Üî Pages (‚ö†Ô∏è √Ä refactorer Phase 18e)
- **Notification System** : NotificationManager + polling Drive
- **Theme System** : ThemeAssignments (Map-based) + theme-assignments.json
- **Link System** : ContentLinks (Map bidirectionnelle) + content-links.json ‚≠ê NEW

---

## üìÅ Structure des fichiers

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx                    # ‚úÖ v2.5 (Phase 18a - Bottom contextuelle)
‚îÇ   ‚îú‚îÄ‚îÄ Navigation.jsx             # ‚úÖ v5.0 (Phase 18a - Bouton dynamique)
‚îÇ   ‚îú‚îÄ‚îÄ UnifiedTopBar.jsx          # ‚úÖ v2.8 (Phase 18a - Settings dropdown)
‚îÇ   ‚îú‚îÄ‚îÄ PhotoViewer.jsx            # v2.7
‚îÇ   ‚îú‚îÄ‚îÄ ThemeModal.jsx             # v1.0
‚îÇ   ‚îú‚îÄ‚îÄ SessionCreationModal.jsx   # v1.1
‚îÇ   ‚îú‚îÄ‚îÄ LinkedContent.jsx          # ‚≠ê NEW Phase 18b
‚îÇ   ‚îú‚îÄ‚îÄ SessionListModal.jsx       # ‚≠ê NEW Phase 18c
‚îÇ   ‚îî‚îÄ‚îÄ pages/
‚îÇ       ‚îú‚îÄ‚îÄ MemoriesPage.jsx       # ‚úÖ v7.1 (Phase 18b - Mode s√©lection)
‚îÇ       ‚îú‚îÄ‚îÄ SessionsPage.jsx       # ‚úÖ v6.3 (Phase 18d - Nouveaux messages)
‚îÇ       ‚îú‚îÄ‚îÄ ChatPage.jsx           # ‚úÖ v2.5 (Phase 18b - Liens + input)
‚îÇ       ‚îî‚îÄ‚îÄ SettingsPage.jsx       # v4.2
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ dataManager.js             # ‚úÖ v3.7 (Phase 18b - Support liens)
‚îÇ   ‚îú‚îÄ‚îÄ ContentLinks.js            # ‚≠ê NEW Phase 18b/c
‚îÇ   ‚îú‚îÄ‚îÄ ConnectionManager.js       # v0.9.0
‚îÇ   ‚îú‚îÄ‚îÄ DriveSync.js               # Pagination (pageSize: 1000)
‚îÇ   ‚îú‚îÄ‚îÄ NotificationManager.js     # v1.0
‚îÇ   ‚îî‚îÄ‚îÄ ThemeAssignments.js        # v1.0
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ useAppState.js             # ‚úÖ v2.1 (Phase 18b - addLink, getLinkedSessions)
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ sessionUtils.js            # v2.0
    ‚îú‚îÄ‚îÄ themeUtils.js              # v1.0
    ‚îî‚îÄ‚îÄ linkUtils.js               # ‚≠ê NEW Phase 18b
```

---

## 

---

## üîß M√©thodologie de travail

### Ce qui fonctionne

1. **√âtapes incr√©mentales** : Petites modifications testables
2. **Tests imm√©diats** : V√©rifier apr√®s chaque changement
3. **Documentation synchrone** : Mettre √† jour le guide en m√™me temps
4. **Git commits fr√©quents** : Historique clair
5. **Analyse m√©thodique** : Logs ‚Üí hypoth√®ses ‚Üí tests
6. **Fichiers complets** : √âviter copier/coller fragment√©
7. **Console.log debugging** : Tracer ex√©cution pas √† pas
8. **Prendre du recul** : Si bug >3 tentatives, revoir approche globale

### Checklist debug

- [ ] Console logs (erreurs rouges)
- [ ] √âtat app (`app.masterIndex`, `app.sessions`)
- [ ] Fichiers Drive (v√©rifier JSON)
- [ ] localStorage.clear() si structure chang√©e
- [ ] Hard refresh apr√®s d√©ploiement
- [ ] V√©rifier `currentUser.id` vs `currentUser`
- [ ] Inspecter DOM (√©l√©ments cach√©s ?)
- [ ] Tests console rapides avant modification code

---

## ‚ú® Phases compl√©t√©es depuis phase 13

### Phase 13B : Messages riches + TopBar unifi√©e + Photos Mastodon

**Date :** D√©cembre 2024

**R√©alisations :**

- Messages avec photos dans bulles utilisateur
- TopBar contextuelle unifi√©e
- Photos Mastodon avec mapping plat
- Stats corrig√©es dans SettingsPage

### Phase 14.1 : Dashboard sessions (Option A+)

**Date :** Janvier 2025

**R√©alisations :**

- Dashboard avec volets Activit√©/Suggestions/Stats
- Filtres par statut (onglets)
- Toggle vue cards/compact
- **Note :** Dashboard supprim√© en Phase 14.2 (redondant)

### Phase 14.2 : Niveau 1 Minimalisme

**Date :** Janvier 2025

**R√©alisations :**

- **SUPPRESSION Dashboard** (maximum espace pour sessions)
- TopBar enrichie avec badges cliquables (üî¥üü°üîµ‚ú®)
- Liste group√©e automatique par statut
- Sections repliables avec m√©morisation
- Filtrage 1 clic via badges TopBar
- **70% moins de code** vs v5.1

### Phase 14.3 : Syst√®me visuel unifi√©

**Date :** 5 janvier 2025

**R√©alisations :**

- **Philosophie design clarifi√©e** : Couleurs discr√®tes + Ic√¥nes explicites
- TopBar MemoriesPage v2.0 :
  - Dropdown filtre (Tous/Non explor√©s/Avec articles/Avec photos)
  - Options affichage inline [üìÑ] [üñºÔ∏è] [üì∏]
  - Suppression menu "..." (options d√©sormais visibles)
- Filtrage intelligent moments avec callbacks expos√©s
- Ic√¥nes unifi√©es : üí¨ Sessions, ‚ú® Moments non explor√©s
- Badge ‚ú® redirige vers Memories

### Phase 15 : Syst√®me de notifications push üîî

**Date :** 6 janvier 2025

**R√©alisations :**

- NotificationManager.js v1.0
- Stockage notifications.json sur Drive
- Syst√®me de statuts avec 4 priorit√©s
- TopBar Sessions avec badges cliquables
- Bouton üîî dans ChatPage
- Auto markAsRead √† l'ouverture/r√©ponse
- sessionUtils v2.0 avec SESSION_STATUS.NOTIFIED

---

### Phase 16 : Syst√®me de th√®mes üè∑Ô∏è ‚≠ê

**Date :** 18 octobre 2025

**Objectif :** Permettre l'organisation th√©matique des contenus (temples, gastronomie, transport, etc.)

**R√©alisations :**

**Architecture s√©par√©e (d√©cision cl√©) :**

- ‚úÖ `ThemeAssignments.js` v1.0 : Manager Map-based
- ‚úÖ `theme-assignments.json` : Fichier Drive s√©par√©
- ‚úÖ `themeUtils.js` v1.0 : Utilitaires (THEME_COLORS, generateThemeId, countThemeContents)
- ‚úÖ Cl√©s standardis√©es : `moment:X`, `post:X`, `photo:X`

**Composants modifi√©s :**

- ‚úÖ `SettingsPage.jsx` v4.2 :
  - Section "Mes th√®mes" avec CRUD
  - Formulaire cr√©ation (nom + emoji + couleur)
  - Liste avec compteurs dynamiques
  - Modal React pour suppression (pas confirm navigateur)
- ‚úÖ `ThemeModal.jsx` v1.0 : Composant r√©utilisable
  - Props flexibles (moment/post/photo)
  - Options propagation intelligentes
  - Indication "(actuel)" sur th√®mes assign√©s
  - Message unifi√© : "G√©rer les th√®mes"
- ‚úÖ `MemoriesPage.jsx` v7.0 :
  - Barre filtres th√®mes (toggle TopBar üè∑Ô∏è)
  - Calcul `themeStats` avec `useMemo`
  - Bouton üè∑Ô∏è sur MomentHeader
  - Badge th√®mes au niveau sous-titre (pastille num√©rot√©e)
- ‚úÖ `UnifiedTopBar.jsx` v2.5 :
  - Bouton toggle th√®mes avec compteur
  - Int√©gration contextuelle Memories
- ‚úÖ `PhotoViewer.jsx` v2.7 :
  - Bouton th√®mes avec pastille si >0
  - Ic√¥ne uniformis√©e (light si 0, pleine si >0)
- ‚úÖ `App.jsx` v2.3 :
  - State `isThemeBarVisible`
  - Props pass√©es √† composants

**Propagation intelligente :**

- Moment ‚Üí Articles + Photos articles + Photos moment (options)
- Post ‚Üí Photos de l'article (option)
- Photo ‚Üí Direct (pas d'options)

**Diff√©rences avec plan original :**

| Aspect           | Pr√©vu                   | R√©alis√©                       | Impact                                    |
| ---------------- | ----------------------- | ----------------------------- | ----------------------------------------- |
| Architecture     | Th√®mes dans masterIndex | ThemeAssignments s√©par√©       | ‚úÖ Meilleur (performance + maintenabilit√©) |
| Propagation      | H√©ritage auto simple    | Options dans modal            | ‚úÖ Meilleur (contr√¥le granulaire)          |
| S√©lection photos | Longpress bulk          | Pas impl√©ment√©                | ‚ö†Ô∏è √Ä ajouter Phase 16b si besoin          |
| Badge placement  | Partout                 | Strat√©gique (header + viewer) | ‚úÖ Meilleur (interface √©pur√©e)             |

**D√©cisions architecturales cl√©s :**

1. **ThemeAssignments s√©par√©** (vs int√©gr√© masterIndex)
   - Raison : Pas de r√©g√©n√©ration masterIndex √† chaque tag
   - Avantage : Performance Map-based vs array search
2. **Modal React suppression** (vs confirm navigateur)
   - Raison : confirm() peut √™tre bloqu√© par param√®tres navigateur
   - Avantage : UX coh√©rente garantie
3. **Pas de s√©lection multiple photos** (report Phase 16b)
   - Raison : Complexit√© vs usage r√©el
   - Workaround : Tag par moment avec propagation

**Impact utilisateur :**

- ‚úÖ Cr√©ation th√®me : 30 secondes

- ‚úÖ Tag moment : 10 secondes (avec propagation)

- ‚úÖ Filtrage : 1 clic

- ‚ö†Ô∏è Tag 100 photos individuellement : P√©nible (‚Üí Phase 16b)
  
  ---
  
  ## Phase 18 :  Navigation Chat ‚Üî Memories avec attachements photos et liens internes
  
  ---

##### ‚úÖ PHASE 18b COMPL√âT√âE - Syst√®me de liens souvenirs

###**

#### **√âtape 2 : Mode s√©lection (100%)**

- ‚úÖ Navigation Chat ‚Üí [üîó+] ‚Üí Memories (mode s√©lection) ‚Üí S√©lection ‚Üí Retour Chat
- ‚úÖ √âtat `selectionMode` + `navigationContext.pendingLink`
- ‚úÖ TopBar : Badge "üîó S√©lectionner" + bouton ‚ùå
- ‚úÖ Conservation filtres essentiels (üìÑ üì∑ üè∑Ô∏è) en mode s√©lection

#### **√âtape 3a-b : LinkedContent & UX (100%)**

- ‚úÖ **LinkedContent.jsx v1.0** cr√©√©
  - Photo : 200px avec hover "üì∑ Voir galerie"
  - Post : Card bleue (titre + preview + compteur photos)
  - Moment : Card violette (titre + stats + liste posts)
- ‚úÖ **Interface unifi√©e** : Boutons [üîó] discrets gris/violet
- ‚úÖ **Pastilles [üîó]** sur thumbnails photos
- ‚úÖ **Bouton [üîó]** dans PhotoViewer

- [ ] 
  
  #### √âtape 3c : LinkedContent & UX (100%)**Navigation retour (1h)** -
  
  [ ] Clic sur lien dans message ‚Üí Navigation Memories - [ ] Auto-open + scroll vers contenu cible -
  
  Support 3 types : moment (ouvrir), post (trouver parent + scroll), photo (visionneuse)
  
  #### ---
  
  ---
  
  ## Phase 19 : Structure session enrichie
  
  ---

### Phase 19 - Structure Session enrichie

**Objectif :** Clarifier les relations Session ‚Üî Contenu avec structure explicite### 

#### **19 A : Fondations donn√©es** (prioritaire)

- **Migrer gameId ‚Üí momentId** dans sessions existantes
- ‚úÖ **Ajouter originContent** dans `createSession()`

#### **19 B : Th√®mes sessions**

‚úÖ √âtendre `ThemeAssignments` pour supporter `session:X` 

 ‚úÖ Bouton üè∑Ô∏è dans ChatPage header (comme MemoriesPage) 

 ‚úÖ Affichage badges th√®mes dans SessionsPage

‚úÖ Affichage badges Session dans MemoriesPage : indique si les√©l√©ments de m√©moires (Moment, post, photoduMoment ) sont li√©s √† des Chat avec üí¨et un nombre



### **19 C : Affichage origine enrichi**

7. ‚úÖ Am√©liorer en-t√™te ChatPage : ``` J012-Hoi An üìç Cr√©√© depuis : Photo "Dragon dor√©" üè∑Ô∏è Temples ¬∑ Architecture



### **19 D : Compteurs üí¨ dans Memories**

8. ‚úÖ Fonction `getAllSessionsForContent()` (union origine + liens)
9. ‚úÖ Pastilles üí¨ sur moments/posts/photos
10. ‚úÖ Modal liste sessions au clic
11. ‚úÖ Navigation vers session depuis modal

---

**Version du guide :** 2.6.2  
**Derni√®re r√©vision :** Phase 19 sp√©cifi√©e - Navigation & Liens  
**Prochaine impl√©mentation :** Phase 19b 3 (Affichage badges th√®mes dans SessionsPage)
